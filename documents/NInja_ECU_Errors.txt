Ninja ECU Errors/Fixes


7/7/2016

-Ninja version 3.2 was printed and assembled. It was delivered 7/5/2016 and we have dicovered a few design problems that were not 
transfered to this design. It is best to view these errors with Ninja ECU 3.2's schematic sheets.
-When ordering the board in the first place, there were a few footprint mismatches. The MOSFETs' (IRFS7530) footprints were not as
tall as the MOSFET and PCB Fab Express couldn't assemble the MOSFETS. We were able to mount them ourselves, but the footprint had 
to be changed to fit the entire MOSFET. The other mismatch was the 100uH and 22uH inductors. The footprint was chosen wthout making
sure the supplier link would match it and the pads were smaller than the actual inductor. The correct footprint has been made and 
named SDR0805.
-Another ordering problem was that the LED's did not have a polarity mark so we mounted them. This problem has been resolved by making
an LED footprint with the polarity mark.
-The DRV chip outputs 5V through a buck converter and we rely on that to provide our power to the board. Pin 55 of the DRV is enable
buck converter which will disable the buck converter if it is pulled down with a resistor. R54 is pulling down that pin, which will
disable the buck converter and disable our 5V power. R54 was supposed to be a DNI resistor and it is now. All we did was desolder 
the resistor to enable the buck converter. 
-There is a syntax error on the "Sheet_Ninja_ECU" schematic sheet for 3.2. It shows how the microcontroller and DRV are connected.
The problem is that N1, N2, N3, P1, P2, and P3 don't match to the correct counterpart on the right. The diagram is as shown below;

P1 --------> INH_A
N1 --------> INH_B
P2 --------> INH_C
N2 --------> INL_A
P3 --------> INL_B
N3 --------> INL_C

The N's are the negative side of the MOSFET bridge, while P's are the positive. INH means high side and INL means low side. The N's
on the left need to match to the L's on the right, while P's go the H's. This caused us to incorrectly design the microcontroller pins
and the pins which needed the same timer PWM signals were not on the correct one. The DRV chip needs three PWM signals from the same 
timer on the microcontroller. The pins that need it are INL_A (Pin 18), INL_B (Pin 20), and INL_C (Pin 22). These pins are not on PWM 
signals from the same timer so we needed to switch them to the same timer. Our solution was to switch Pin 91 of the STM (which is net
InN2 on 3.2's sheet) to either pin 60 or 61. This would allow INL_A, INL_B, and INL_C to be connected to timer 4 on a PWM signal. Which
means the encoder had to be switched to timer 8 which moved it to pins 63 and 64. This was all done by breaking the track originally 
connected to the pins we need to move and soldering a very thin wire to the pins, then moving it to the corresponding correct pins. 
-There are two problems involving the FT4232 USB chip. The first is that the receive and transmit lines were reversed connecting the
MAX3485 to the FT4232. Pin 1 of the MAX needs to go to pin 27 of the FT, while pin 4 of the MAX needs to go to pin 26 of the FT. These
two lines were cut and switch by soldering wires on the board. The other problem involved the MAX3485 as well. Complete design flaw 
which could've been avoided by reviewing the schematic more. Pin 8 of the MAX says VCC but is connected to ground while pin 5 is 
connected to 3.3V. We are going to raise the pins and connect them to the correct power and ground.
-One thing to make our lives easier is to make the power and BLDC holes larger to allow the thick cables to go in easier. We made it
3.2mm in diameter.